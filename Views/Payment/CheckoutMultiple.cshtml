@model PrimeMarket.Models.ViewModel.MultipleCheckoutViewModel
@{
    ViewData["Title"] = "Checkout";
    Layout = "~/Views/Shared/_LayoutUser.cshtml";
}

<div class="container" style="margin-top: 120px; margin-bottom: 50px;">
    <h1>Checkout</h1>

    <div class="checkout-container">
        <div class="checkout-summary">
            <h2>Order Summary</h2>

            @foreach (var item in Model.Items)
            {
                <div class="item-summary" data-bookmark-id="@item.BookmarkId" data-price="@item.Price">
                    <div class="item-image">
                        <img src="@item.ImageUrl" alt="@item.Title" width="80" height="80">
                    </div>
                    <div class="item-details">
                        <h3>@item.Title</h3>
                        <p class="seller">Seller: @item.SellerName</p>
                        <div class="quantity-wrapper">
                            <label>Quantity: </label>
                            <span class="quantity-display">@ViewData[$"Quantity_{item.BookmarkId}"] ?? 1</span>
                            <input type="hidden" name="quantities[@item.BookmarkId]"
                                   class="item-quantity"
                                   value="@(ViewData[$"Quantity_{item.BookmarkId}"] ?? 1)" />
                        </div>
                        <p class="price">
                            <span class="unit-price">@item.Price.ToString("C")</span> ×
                            <span class="quantity-text">@(ViewData[$"Quantity_{item.BookmarkId}"] ?? 1)</span> =
                            <span class="item-total">@((item.Price * (ViewData[$"Quantity_{item.BookmarkId}"] != null ? Convert.ToInt32(ViewData[$"Quantity_{item.BookmarkId}"]) : 1)).ToString("C"))</span>
                        </p>
                    </div>
                </div>
            }

            <div class="order-total">
                <div class="total-label">Total</div>
                <div class="total-amount" id="checkout-total">@Model.TotalPrice.ToString("C")</div>
            </div>
        </div>

        <div class="checkout-payment">
            <h2>Payment Details</h2>

            @if (TempData["ErrorMessage"] != null)
            {
                <div class="alert alert-danger">
                    @TempData["ErrorMessage"]
                </div>
            }

            <form id="paymentForm" method="post" action="@Url.Action("ProcessMultiplePayment")">
                @Html.AntiForgeryToken()

                <div class="form-group">
                    <label for="cardholderName">Cardholder Name</label>
                    <input type="text" id="cardholderName" name="CardholderName" placeholder="Name on card" required>
                </div>

                <div class="form-group">
                    <label for="cardNumber">Card Number</label>
                    <input type="text" id="cardNumber" name="CardNumber" placeholder="1234 5678 9012 3456" required
                           maxlength="19" pattern="[0-9\s]{13,19}">
                </div>

                <div class="form-row">
                    <div class="form-group half">
                        <label for="expiryDate">Expiry Date</label>
                        <input type="text" id="expiryDate" name="ExpiryDate" placeholder="MM/YY" required
                               maxlength="5" pattern="(0[1-9]|1[0-2])\/[0-9]{2}">
                    </div>

                    <div class="form-group half">
                        <label for="cvv">CVV</label>
                        <input type="password" id="cvv" name="Cvv" placeholder="123" required
                               maxlength="4" pattern="[0-9]{3,4}">
                    </div>
                </div>

                <!-- Hidden fields for quantities -->
                <div id="quantities-container">
                    @foreach (var item in Model.Items)
                    {
                        <input type="hidden" name="quantities[@item.BookmarkId].BookmarkId" value="@item.BookmarkId" />
                        <input type="hidden" name="quantities[@item.BookmarkId].Quantity"
                               value="@(ViewData[$"Quantity_{item.BookmarkId}"] ?? 1)"
                               id="quantity-input-@item.BookmarkId" />
                    }
                </div>

                <div class="payment-actions">
                    <a href="@Url.Action("Cart")" class="btn-cancel">Cancel</a>
                    <button type="submit" class="btn-pay">Pay Now <span id="payment-amount">@Model.TotalPrice.ToString("C")</span></button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    .checkout-container {
        display: flex;
        gap: 30px;
        margin-top: 30px;
    }

    .checkout-summary {
        flex: 0 0 40%;
        background-color: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
    }

    .checkout-payment {
        flex: 0 0 55%;
        background-color: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
    }

    .item-summary {
        display: flex;
        margin: 20px 0;
        padding-bottom: 20px;
        border-bottom: 1px solid #ddd;
    }

    .item-image {
        margin-right: 15px;
    }

        .item-image img {
            border-radius: 8px;
            object-fit: cover;
        }

    .item-details h3 {
        margin: 0 0 10px 0;
        font-size: 16px;
    }

    .seller {
        color: #666;
        margin-bottom: 5px;
        font-size: 14px;
    }

    .price {
        font-weight: bold;
        color: #0066cc;
    }

    .quantity-wrapper {
        margin: 5px 0;
        color: #555;
    }

    .quantity-display {
        font-weight: bold;
    }

    .unit-price {
        color: #666;
    }

    .item-total {
        font-weight: bold;
        color: #28a745;
    }

    .order-total {
        display: flex;
        justify-content: space-between;
        padding-top: 15px;
        font-size: 18px;
        font-weight: bold;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-row {
        display: flex;
        gap: 20px;
    }

    .form-group.half {
        flex: 1;
    }

    label {
        display: block;
        margin-bottom: 8